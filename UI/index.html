<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
<link rel="icon" href="sn.png" />
    <title>AutoMart App</title>
	<link rel="stylesheet" href="main.css"/>
	<link rel="stylesheet" href="pageRegulator.css"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="server.js" type="text/javascript"></script>

	 <script> 
 		function toggleag(){
           var ele3 = document.getElementById("login");

           if (ele3.style.display == "none") {
              ele3.style.display = "block";
			  
           }
           else
           {
             ele3.style.display = "none";
			 
           }
		   
		   
         }
		 
		
function on() {
  document.getElementById("overlay").style.display = "block";
}

function off() {
  document.getElementById("overlay").style.display = "none";
}



function opennav() {

  document.getElementById("mynavbar").style.width = "100%";
  document.getElementById("myrightnav").style.width = "100%";
  
}

function closenav() {
  document.getElementById("mynavbar").style.width = "0";
  document.getElementById("myrightnav").style.width = "0";
  document.getElementById("myrightnav").style = "@media (min-width: 992px){.rightNav{width:100%;}}";
  document.getElementById("mynavbar").style = "@media (min-width: 992px){.navbar-nav{width:100%;}}";
}
function closelog(){
document.getElementById("login").style.display = "none";
}
 </script>
  </head>
  <body>
  
  <nav id='navContainer'>
  <img src="sn.png" class="logo" style="float:left;"/>
  <button class="openbtn" onclick="opennav()">&#9776;</button> 
  <ul class="navbar-nav" id="mynavbar">
  <li><a href="javascript:void(0)" class="closebtn" onclick="closenav()">&times;</a></li>
            <li class="active" tabindex="-1"><a href="index.html">Home</a></li>
            <li tabindex="-1"><a href="">About</a></li>
            <li tabindex="-1"><a href="ad.html">Adverts</a></li>
	   <li tabindex="-1"><a href="admin.html"><span id="dAdmin" style="display:none;">Admin</span></a></li>
            </ul>
   <ul class="rightNav" id="myrightnav">
   <li><a href="javascript:;" onclick="toggleag();">Sign In</a></li>
</ul>   
  </nav>
  
  <div id="login">
  
    <a href="javascript:void(0)" class="closebtnn" onclick="closelog()">&times;</a>
              <div > <h2>Sign In</h2> </div>
               
                <input type="text" required class="control" id="logEmail" placeholder="Enter Email Address">
          
              <br/>
			  <br/>

                <input type="text" required class="control" id="password" placeholder="Provided Your Password">
           
              <br/>
             <br/>
            
               
			  <input type="button" class="btn" id="loginn" value="Sign In"/>

  </div>

  <div id="firstContainer" class = "fade">
  <div class="topHeadDiv">
    <h2 id="topHead">Auto Mart</h2>
	<div style="font-weight:bold; color:gold; text-align:center;" id="logMessage"></div>
	<center style="color:white; font-style:italic; padding:1% 5% 5% 5%; font-size:1.2em;"> Auto Mart is an online marketplace for automobiles of diverse makes, model or body type. With
Auto Mart, users can sell their cars or buy from trusted dealerships or private sellers.
<div class="signUp">
   <a href="javascript:;" onclick="on()">Get Started</a>
</div> 
</center>
    </div>

 </div>  
<div id="overlay" class="fade">
<center>
<div id="centerForm">
<a href="javascript:;" onclick="off()" style="text-align:right; float:right; background-color:rgba(250,0,30,0.8); border-radius:50%; padding:1% 2% 1% 2%; color:white; text-decoration:none;">X</a>
  

<h3 id="secondHead">Sign Up For Free!</h3>
<div id="response"></div>
<div id="message"></div>
              
                
                <input type="text" required id="firstName" onkeyup="signupcheck();" placeholder="First Name" class="control">
          <div id="fnameResponse"></div>
              <br/>
			  <input type="text" required class="control" id="lastName" onkeyup="signupcheck();" placeholder="Last Name">
           
            <div id="lnameResponse"></div>
             <br/>

                <input type="text" required class="control" id="email" onkeyup="signupcheck();" placeholder="Email Address">
           
             <div id="emailResponse"></div>
             <br/>
                
                <input type="text" required class="control" id="phone" onkeyup="signupcheck();" placeholder="Mobile Phone Number">
            
              <div id="phoneResponse"></div>
			 <br/>
			 
			 <input type="text" required class="control" id="address" onkeyup="signupcheck();" placeholder="Address">
            
             <div id="addressResponse"></div>
			 <br/>
                
                <input type="password" required class="control" id="passWord" onkeyup="signupcheck();" placeholder="Your Password">
           
             <div id="passResponse"></div>
              <br/>
			  <input type="password" required class="control" id="confpassword" onkeyup="signupcheck();" placeholder="Confirm Your Password">
           
              <div id="confPassResponse"></div>
              <br/>
			  
			  <select class="control" id="admin" onkeyup="signupcheck();">
			  <option value="">Select As Admin</option>
			  <option value="non_admin">Non Admin</option>
			  <option value="admin">Admin</option>
              </select>
              <div id="confAdminResponse"></div>
              <br/>
               
			  <input type="button" class="btn" id="signUp" value="Sign Up"/>

       
		</div>
<script>
 function signupcheck(){
 document.getElementById("fnameResponse").innerHTML = "";
 document.getElementById("lnameResponse").innerHTML = "";
  document.getElementById("emailResponse").innerHTML = "";
   document.getElementById("phoneResponse").innerHTML = "";
    document.getElementById("addressResponse").innerHTML = "";
	document.getElementById("confAdminResponse").innerHTML = "";
	document.getElementById("passResponse").innerHTML = "";
	document.getElementById("confPassResponse").innerHTML = "";
	
var admin = document.getElementById("admin").value;
var firstname = document.getElementById("firstName").value;
var lastname = 	document.getElementById("lastName").value;
var emailAddress = document.getElementById("email").value;
var phone = document.getElementById("phone").value;
var address = document.getElementById("address").value;
var password = document.getElementById("passWord").value;
var confpassword = document.getElementById("confpassword").value;
var firstResponse = document.getElementById("fnameResponse");
var lastResponse = document.getElementById("lnameResponse");
var emailresponse = document.getElementById("emailResponse");
var phoneResponse = document.getElementById("phoneResponse");
var addressResponse = document.getElementById("addressResponse");
var passResponse = document.getElementById("passResponse");
var confPassResponse = document.getElementById("confPassResponse");
var confAdminResponse = document.getElementById("confAdminResponse");


	
 if(firstname == ""){
 firstResponse.innerHTML = "*Provide Your Firstname*";
 firstResponse.style.color = "red";
 }else if(lastname == ""){
 lastResponse.innerHTML = "*Provide Your Lastname*";
 lastResponse.style.color = "red";
 }else if(emailAddress == ""){
 emailresponse.innerHTML = "*Provide Your Email Address*";
 emailresponse.style.color = "red";
 }else if(phone == ""){
 phoneResponse.innerHTML = "*Provide Your Phone Number*";
 phoneResponse.style.color = "red";
 }else if(isNaN(parseInt(phone)) == true){
 phoneResponse.innerHTML = "*Phone Number Can Only Be In Digits!*";
 phoneResponse.style.color = "red";
 }else if(address == ""){
 addressResponse.innerHTML = "*Provide Your Address*";
 addressResponse.style.color = "red";
 }else if( password == ""){
 passResponse.innerHTML = "*Provide Your Password*";
 passResponse.style.color = "red";
 }else if(confpassword != password){
 confPassResponse.innerHTML = "*Confirm Password is not the same as Password*";
 confPassResponse.style.color = "red";
 }else if(admin == ""){
 confAdminResponse.innerHTML = "*Is This User an Admin Or Not, please select as appropriate*";
 confAdminResponse.style.color = "red";
 }
 

 }
 
 function randomString() {
var chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
var string_length = 8;
	var randomstring = '';
	for (var i=0; i<string_length; i++) {
		var rnum = Math.floor(Math.random() * chars.length);
		randomstring += chars.substring(rnum,rnum+1);
	}
	return randomstring;
}
 
 var loginfo = {};
 
 function login(){
 
 var email = document.getElementById("logEmail").value;
 var password = document.getElementById("password").value;
 
loginfo['email'] = email;
loginfo['password'] = password;

 }
 
$(document).on('click','#loginn',function(){
login();
		$.ajax({
        	url: "/auth/signin",   	
			type: "POST",      				
			data:  JSON.stringify(loginfo), 		
			contentType: false,       		
    	    cache: false,					
			processData:false,  			
			success: function(data)  		
		    {
		
			if(data.status == 404){
			console.log(data);
			$("#logMessage").html(data.error);
			}else{
			console.log(data);
			const {data: {id, first_name, last_name, email, token, secretKey,is_admin}} = data;

			$("#logMessage").html(last_name + " " + first_name + " Successfully Logged In!");
			$("#myrightnav").css("display", "none");
			$("#login").css("display", "none");
			if(is_admin == true){
			$("#dAdmin").css("display", "block");
			}
			sessionStorage.setItem("secretKey", secretKey);	
			sessionStorage.setItem("token", token);	
            sessionStorage.setItem("email", email);	
            sessionStorage.setItem("id", id);	
			}
			
		    }	        
	   });
	});

 
 // send data to server 
 var userinfo = {};
 function signup(){
 
 var first_name = document.getElementById("firstName").value;
 var last_name = document.getElementById("lastName").value;
 var email = document.getElementById("email").value;
 var phone = document.getElementById("phone").value;
 var address = document.getElementById("address").value;
 var password = document.getElementById("passWord").value;
 var cadmin = document.getElementById("admin").value;
 
 var is_admin = false;
if(cadmin == "non_admin"){
is_admin = false;
}else if(cadmin == "admin"){
is_admin = true;
}
 
userinfo['first_name'] = first_name;
userinfo['last_name'] = last_name;
userinfo['password'] = password;
userinfo['address'] = address;
userinfo['email'] = email;
userinfo['phone'] = phone;
userinfo['is_admin'] = is_admin;

}
 $(document).on('click','#signUp',function(){
signup();
		$.ajax({
        	url: "/auth/signup",   	
			type: "POST",      				
			data:  JSON.stringify(userinfo), 		
			contentType: false,       		
    	    cache: false,					
			processData:false,  			
			success: function(data)  		
		    {
			if(data.status == 404){
			console.log(data);
			$("#message").html(data.error);
			}else{
			console.log(data);
			const {data: {id, first_name, last_name, email, token, secretKey, is_admin}} = data;

			$("#logMessage").html(last_name + " " + first_name + "'s Account Successfully Created");
			$("#myrightnav").css("display", "none");
			$("#login").css("display", "none");
			$("#overlay").css("display", "none");
			if(is_admin == true){
			$("#dAdmin").css("display", "block");
			}
			sessionStorage.setItem("secretKey", secretKey);	
			sessionStorage.setItem("token", token);	
            sessionStorage.setItem("email", email);	
            sessionStorage.setItem("id", id);	
             }			
		    }	        
	   });
	});


 </script>
</center>
</div> 
<footer style="background-color:black; height:50px; color:grey; text-align:center; padding-top:20px;">
Copyright: &copy; Auto Mart <? echo date("Y"); ?>
</footer>
  </body>
</html>
